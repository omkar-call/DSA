USE info;

DROP TABLE IF EXISTS borrower1;
DROP TABLE IF EXISTS audit1;

CREATE TABLE borrower1 (
    roll_no INT,
    name VARCHAR(20),
    date_of_issue DATE,
    book_name VARCHAR(30),
    status VARCHAR(20),
    author VARCHAR(30)
);

CREATE TABLE audit1 (
    roll_no INT,
    name VARCHAR(20),
    date_of_issue DATE,
    book_name VARCHAR(30),
    status VARCHAR(20),
    author VARCHAR(30),
    ts TIMESTAMP
);

INSERT INTO borrower1 VALUES
(1, 'nick', '2018-06-10', 'wings_of_fire', 'available', 'APJ'),
(2, 'mira', '2018-05-11', 'leaves_life', 'not_available', 'borwarkar'),
(3, 'rina', '2018-02-12', 'unusual', 'available', 'johar'),
(4, 'harsha', '2018-06-20', 'skylimit', 'available', 'ingale'),
(5, 'tej', '2018-04-20', 'highway', 'not_available', 'klm');

DELIMITER //

CREATE TRIGGER library_after_insert
AFTER INSERT ON borrower1
FOR EACH ROW
BEGIN
    INSERT INTO audit1 
    VALUES (NEW.roll_no, NEW.name, NEW.date_of_issue, NEW.book_name, NEW.status, NEW.author, CURRENT_TIMESTAMP);
END;
//

CREATE TRIGGER library_after_update
AFTER UPDATE ON borrower1
FOR EACH ROW
BEGIN
    INSERT INTO audit1 
    VALUES (NEW.roll_no, NEW.name, NEW.date_of_issue, NEW.book_name, NEW.status, NEW.author, CURRENT_TIMESTAMP);
END;
//

CREATE TRIGGER library_after_delete
AFTER DELETE ON borrower1
FOR EACH ROW
BEGIN
    INSERT INTO audit1 
    VALUES (OLD.roll_no, OLD.name, OLD.date_of_issue, OLD.book_name, OLD.status, OLD.author, CURRENT_TIMESTAMP);
END;
//

DELIMITER ;

INSERT INTO borrower1 VALUES (6, 'xyz', '2018-09-06', 'aaa', 'available', 'xxx');

UPDATE borrower1 SET roll_no = 8, book_name = 'leaf' WHERE name = 'xyz';

DELETE FROM borrower1 WHERE roll_no = 8;

SELECT * FROM borrower1;
SELECT * FROM audit1;
